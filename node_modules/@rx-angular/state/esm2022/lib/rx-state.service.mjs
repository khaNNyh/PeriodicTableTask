import { computed, inject, Injectable, Injector, isSignal, } from '@angular/core';
import { toObservable, toSignal } from '@angular/core/rxjs-interop';
import { createAccumulationObservable, createSideEffectObservable, isKeyOf, safePluck, select, } from '@rx-angular/state/selections';
import { BehaviorSubject, EMPTY, isObservable, Subject, Subscription, } from 'rxjs';
import { catchError, map, tap } from 'rxjs/operators';
import { RX_ACCUMULATOR_FN, RX_STATE_SCHEDULER, } from './provide-rx-state-config';
import { createSignalStateProxy } from './signal-state-proxy';
import * as i0 from "@angular/core";
/**
 * @description
 * RxState is a light-weight reactive state management service for managing local state in angular.
 *
 * @example
 * Component({
 *   selector: 'app-stateful',
 *   template: `<div>{{ state$ | async | json }}</div>`,
 *   providers: [RxState]
 * })
 * export class StatefulComponent {
 *   readonly state$ = this.state.select();
 *
 *   constructor(private state: RxState<{ foo: string }>) {}
 * }
 *
 * @docsCategory RxState
 * @docsPage RxState
 */
export class RxState {
    subscription = new Subscription();
    scheduler = inject(RX_STATE_SCHEDULER, { optional: true });
    accumulator = createAccumulationObservable(new Subject(), new Subject(), new BehaviorSubject(inject(RX_ACCUMULATOR_FN)), this.scheduler === 'sync' ? null : this.scheduler);
    effectObservable = createSideEffectObservable(new Subject(), this.scheduler === 'sync' ? null : this.scheduler);
    injector = inject(Injector);
    signalStoreProxy;
    /**
     * @description
     * The unmodified state exposed as `Observable<State>`. It is not shared, distinct or gets replayed.
     * Use the `$` property if you want to read the state without having applied {@link stateful} to it.
     */
    $ = this.accumulator.signal$;
    /**
     * @internal
     */
    constructor() {
        this.subscription.add(this.subscribe());
    }
    /**
     * @internal
     */
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    /**
     * @description
     *
     * Return RxState in ReadOnly mode exposing only methods for reading state
     * get(), select(), computed() and signal() methods.
     * This can be helpful when you don't want others to write in your state.
     *
     * @example
     * ```typescript
     * const readOnlyState = state.asReadOnly();
     * const getNum = state.get('num');
     * const selectNum$ = state.select('num');
     * ```
     *
     * @return Pick<RxState<State>, ReadOnly>
     */
    asReadOnly() {
        return {
            get: this.get.bind(this),
            select: this.select.bind(this),
            computed: this.computed.bind(this),
            signal: this.signal.bind(this),
        };
    }
    /**
     * @description
     *
     * Allows to customize state accumulation function.
     * This can be helpful to implement deep updates and tackle other immutability problems in a custom way.
     * @example
     *
     * ```typescript
     * const myAccumulator = (state: MyState, slice: Partial<MyState>) => deepCopy(state, slice);
     *
     * this.state.setAccumulator(myAccumulator);
     * ```
     *
     * @param {AccumulationFn} accumulatorFn
     * @return void
     *
     * @deprecated
     * Use `provideRxStateConfig` and provide the accumulator with the `withAccumulator` provider function.
     * Will be removed in future versions.
     */
    setAccumulator(accumulatorFn) {
        this.accumulator.nextAccumulator(accumulatorFn);
    }
    /** @internal **/
    get(...keys) {
        const hasStateAnyKeys = Object.keys(this.accumulator.state).length > 0;
        if (!!keys && keys.length) {
            return safePluck(this.accumulator.state, keys);
        }
        else {
            return hasStateAnyKeys
                ? this.accumulator.state
                : undefined;
        }
    }
    /**
     * @internal
     */
    set(keyOrStateOrProjectState, stateOrSliceProjectFn) {
        if (typeof keyOrStateOrProjectState === 'object' &&
            stateOrSliceProjectFn === undefined) {
            this.accumulator.nextSlice(keyOrStateOrProjectState);
            return;
        }
        if (typeof keyOrStateOrProjectState === 'function' &&
            stateOrSliceProjectFn === undefined) {
            this.accumulator.nextSlice(keyOrStateOrProjectState(this.accumulator.state));
            return;
        }
        if (isKeyOf(keyOrStateOrProjectState) &&
            typeof stateOrSliceProjectFn === 'function') {
            const state = {};
            state[keyOrStateOrProjectState] = stateOrSliceProjectFn(this.accumulator.state);
            this.accumulator.nextSlice(state);
            return;
        }
        throw new Error('wrong params passed to set');
    }
    /**
     * @internal
     */
    connect(keyOrInputOrSlice$, projectOrSlices$, projectValueFn) {
        /**
         * From top to bottom the overloads are handled.
         */
        if (isObservable(keyOrInputOrSlice$) &&
            !projectOrSlices$ &&
            !projectValueFn) {
            this.accumulator.nextSliceObservable(keyOrInputOrSlice$);
            return;
        }
        if (isSignal(keyOrInputOrSlice$) && !projectOrSlices$ && !projectValueFn) {
            this.accumulator.nextSliceObservable(toObservable(keyOrInputOrSlice$, { injector: this.injector }));
            return;
        }
        if (isObservable(keyOrInputOrSlice$) &&
            projectOrSlices$ &&
            typeof projectOrSlices$ === 'function' &&
            !projectValueFn) {
            const projectionStateFn = projectOrSlices$;
            const slice$ = keyOrInputOrSlice$.pipe(map((v) => projectionStateFn(this.accumulator.state, v)));
            this.accumulator.nextSliceObservable(slice$);
            return;
        }
        if (isSignal(keyOrInputOrSlice$) &&
            projectOrSlices$ &&
            typeof projectOrSlices$ === 'function' &&
            !projectValueFn) {
            const projectionStateFn = projectOrSlices$;
            const slice$ = toObservable(keyOrInputOrSlice$, {
                injector: this.injector,
            }).pipe(map((v) => projectionStateFn(this.accumulator.state, v)));
            this.accumulator.nextSliceObservable(slice$);
            return;
        }
        if (isKeyOf(keyOrInputOrSlice$) &&
            isObservable(projectOrSlices$) &&
            !projectValueFn) {
            const slice$ = projectOrSlices$.pipe(map((value) => ({ ...{}, [keyOrInputOrSlice$]: value })));
            this.accumulator.nextSliceObservable(slice$);
            return;
        }
        if (isKeyOf(keyOrInputOrSlice$) &&
            isSignal(projectOrSlices$) &&
            !projectValueFn) {
            const slice$ = toObservable(projectOrSlices$, {
                injector: this.injector,
            }).pipe(map((value) => ({ ...{}, [keyOrInputOrSlice$]: value })));
            this.accumulator.nextSliceObservable(slice$);
            return;
        }
        if (projectValueFn &&
            typeof projectValueFn === 'function' &&
            isKeyOf(keyOrInputOrSlice$) &&
            isObservable(projectOrSlices$)) {
            const key = keyOrInputOrSlice$;
            const slice$ = projectOrSlices$.pipe(map((value) => ({
                ...{},
                [key]: projectValueFn(this.get(), value),
            })));
            this.accumulator.nextSliceObservable(slice$);
            return;
        }
        if (projectValueFn &&
            typeof projectValueFn === 'function' &&
            isKeyOf(keyOrInputOrSlice$) &&
            isSignal(projectOrSlices$)) {
            const key = keyOrInputOrSlice$;
            const slice$ = toObservable(projectOrSlices$, {
                injector: this.injector,
            }).pipe(map((value) => ({
                ...{},
                [key]: projectValueFn(this.get(), value),
            })));
            this.accumulator.nextSliceObservable(slice$);
            return;
        }
        throw new Error('wrong params passed to connect');
    }
    /**
     * @internal
     */
    select(...args) {
        return this.accumulator.state$.pipe(select(...args));
    }
    /**
     * @description
     * Returns a signal of the given key. It's first value is determined by the
     * current keys value in RxState. Whenever the key gets updated, the signal
     * will also be updated accordingly.
     *
     * @example
     * const fooSignal = state.signal('foo');
     *
     * @param {Key} key
     *
     * @return Signal<State[Key]>
     */
    signal(key) {
        return this.signalStoreProxy[key];
    }
    /**
     * @description
     * Lets you create a computed signal based off multiple keys stored in RxState.
     *
     * @example
     * const computedSignal = state.computed((s) => s.foo + s.bar);
     *
     * @param {(slice: SignalStateProxy<Type>) => ComputedType} fn
     * @return Signal<ComputedType>
     */
    computed(fn) {
        return computed(() => {
            return fn(this.signalStoreProxy);
        });
    }
    /** @internal */
    computedFrom(...ops) {
        return toSignal(this.select(...ops), {
            injector: this.injector,
            requireSync: true,
        });
    }
    /**
     * @description
     * Manages side-effects of your state. Provide an `Observable<any>`
     * **side-effect** and an optional `sideEffectFunction`.
     * Subscription handling is done automatically.
     *
     * @example
     * // Directly pass an observable side-effect
     * const localStorageEffect$ = changes$.pipe(
     *  tap(changes => storeChanges(changes))
     * );
     * state.hold(localStorageEffect$);
     *
     * // Pass an additional `sideEffectFunction`
     *
     * const localStorageEffectFn = changes => storeChanges(changes);
     * state.hold(changes$, localStorageEffectFn);
     *
     * @param {Observable<SideEffect>} obsOrObsWithSideEffect
     * @param {function} [sideEffectFn]
     *
     * @return void
     */
    hold(obsOrObsWithSideEffect, sideEffectFn) {
        const sideEffect = obsOrObsWithSideEffect.pipe(catchError((e) => EMPTY));
        if (typeof sideEffectFn === 'function') {
            this.effectObservable.nextEffectObservable(sideEffect.pipe(tap(sideEffectFn)));
            return;
        }
        this.effectObservable.nextEffectObservable(sideEffect);
    }
    /**
     * @internal
     */
    subscribe() {
        const subscription = new Subscription();
        subscription.add(this.accumulator.subscribe());
        subscription.add(this.effectObservable.subscribe());
        this.signalStoreProxy = createSignalStateProxy(this.$, this.get.bind(this));
        return subscription;
    }
    /** @nocollapse */ static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: RxState, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
    /** @nocollapse */ static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: RxState });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.1", ngImport: i0, type: RxState, decorators: [{
            type: Injectable
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicngtc3RhdGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYnMvc3RhdGUvc3JjL2xpYi9yeC1zdGF0ZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxRQUFRLEVBQ1IsTUFBTSxFQUNOLFVBQVUsRUFDVixRQUFRLEVBQ1IsUUFBUSxHQUdULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDcEUsT0FBTyxFQUVMLDRCQUE0QixFQUM1QiwwQkFBMEIsRUFDMUIsT0FBTyxFQUdQLFNBQVMsRUFDVCxNQUFNLEdBQ1AsTUFBTSw4QkFBOEIsQ0FBQztBQUN0QyxPQUFPLEVBQ0wsZUFBZSxFQUNmLEtBQUssRUFDTCxZQUFZLEVBR1osT0FBTyxFQUVQLFlBQVksR0FFYixNQUFNLE1BQU0sQ0FBQztBQUNkLE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsa0JBQWtCLEdBQ25CLE1BQU0sMkJBQTJCLENBQUM7QUFDbkMsT0FBTyxFQUFFLHNCQUFzQixFQUFvQixNQUFNLHNCQUFzQixDQUFDOztBQW9CaEY7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQWtCRztBQUVILE1BQU0sT0FBTyxPQUFPO0lBR1YsWUFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUFFaEMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBRTdELFdBQVcsR0FBRyw0QkFBNEIsQ0FDaEQsSUFBSSxPQUFPLEVBQThCLEVBQ3pDLElBQUksT0FBTyxFQUFrQixFQUM3QixJQUFJLGVBQWUsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUM5QyxJ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O1FBRXhDLE1BQU0sVUFBVSxHQUFHLHNCQUFzQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDekUsSUFBSSxPQUFPLFlBQVksS0FBSyxVQUFVLEVBQUUsQ0FBQztZQUN2QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLENBQ3hDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQ25DLENBQUM7WUFDRixPQUFPO1FBQ1QsQ0FBQztRQUNELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTO1FBQ1AsTUFBTSxZQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN4QyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUMvQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxzQkFBc0IsQ0FDNUMsSUFBSSxDQUFDLENBQUMsRUFDTixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FDcEIsQ0FBQztRQUNGLE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7MEhBcDhCVSxPQUFPOzhIQUFQLE9BQU87OzJGQUFQLE9BQU87a0JBRG5CLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBjb21wdXRlZCxcbiAgaW5qZWN0LFxuICBJbmplY3RhYmxlLFxuICBJbmplY3RvcixcbiAgaXNTaWduYWwsXG4gIE9uRGVzdHJveSxcbiAgU2lnbmFsLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHRvT2JzZXJ2YWJsZSwgdG9TaWduYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5pbXBvcnQge1xuICBBY2N1bXVsYXRpb25GbixcbiAgY3JlYXRlQWNjdW11bGF0aW9uT2JzZXJ2YWJsZSxcbiAgY3JlYXRlU2lkZUVmZmVjdE9ic2VydmFibGUsXG4gIGlzS2V5T2YsXG4gIEtleUNvbXBhcmVNYXAsXG4gIFBpY2tTbGljZSxcbiAgc2FmZVBsdWNrLFxuICBzZWxlY3QsXG59IGZyb20gJ0ByeC1hbmd1bGFyL3N0YXRlL3NlbGVjdGlvbnMnO1xuaW1wb3J0IHtcbiAgQmVoYXZpb3JTdWJqZWN0LFxuICBFTVBUWSxcbiAgaXNPYnNlcnZhYmxlLFxuICBPYnNlcnZhYmxlLFxuICBPcGVyYXRvckZ1bmN0aW9uLFxuICBTdWJqZWN0LFxuICBTdWJzY3JpYmFibGUsXG4gIFN1YnNjcmlwdGlvbixcbiAgVW5zdWJzY3JpYmFibGUsXG59IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICBSWF9BQ0NVTVVMQVRPUl9GTixcbiAgUlhfU1RBVEVfU0NIRURVTEVSLFxufSBmcm9tICcuL3Byb3ZpZGUtcngtc3RhdGUtY29uZmlnJztcbmltcG9ydCB7IGNyZWF0ZVNpZ25hbFN0YXRlUHJveHksIFNpZ25hbFN0YXRlUHJveHkgfSBmcm9tICcuL3NpZ25hbC1zdGF0ZS1wcm94eSc7XG5cbmV4cG9ydCB0eXBlIFByb2plY3RTdGF0ZUZuPFR5cGU+ID0gKG9sZFN0YXRlOiBUeXBlKSA9PiBQYXJ0aWFsPFR5cGU+O1xuXG5leHBvcnQgdHlwZSBQcm9qZWN0VmFsdWVGbjxUeXBlLCBLZXkgZXh0ZW5kcyBrZXlvZiBUeXBlPiA9IChcbiAgb2xkU3RhdGU6IFR5cGUsXG4pID0+IFR5cGVbS2V5XTtcblxuZXhwb3J0IHR5cGUgUHJvamVjdFN0YXRlUmVkdWNlcjxUeXBlLCBWYWx1ZT4gPSAoXG4gIG9sZFN0YXRlOiBUeXBlLFxuICB2YWx1ZTogVmFsdWUsXG4pID0+IFBhcnRpYWw8VHlwZT47XG5cbmV4cG9ydCB0eXBlIFByb2plY3RWYWx1ZVJlZHVjZXI8VHlwZSwgS2V5IGV4dGVuZHMga2V5b2YgVHlwZSwgVmFsdWU+ID0gKFxuICBvbGRTdGF0ZTogVHlwZSxcbiAgdmFsdWU6IFZhbHVlLFxuKSA9PiBUeXBlW0tleV07XG5cbmV4cG9ydCB0eXBlIFJlYWRPbmx5ID0gJ2dldCcgfCAnc2VsZWN0JyB8ICdjb21wdXRlZCcgfCAnc2lnbmFsJztcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJ4U3RhdGUgaXMgYSBsaWdodC13ZWlnaHQgcmVhY3RpdmUgc3RhdGUgbWFuYWdlbWVudCBzZXJ2aWNlIGZvciBtYW5hZ2luZyBsb2NhbCBzdGF0ZSBpbiBhbmd1bGFyLlxuICpcbiAqIEBleGFtcGxlXG4gKiBDb21wb25lbnQoe1xuICogICBzZWxlY3RvcjogJ2FwcC1zdGF0ZWZ1bCcsXG4gKiAgIHRlbXBsYXRlOiBgPGRpdj57eyBzdGF0ZSQgfCBhc3luYyB8IGpzb24gfX08L2Rpdj5gLFxuICogICBwcm92aWRlcnM6IFtSeFN0YXRlXVxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBTdGF0ZWZ1bENvbXBvbmVudCB7XG4gKiAgIHJlYWRvbmx5IHN0YXRlJCA9IHRoaXMuc3RhdGUuc2VsZWN0KCk7XG4gKlxuICogICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0YXRlOiBSeFN0YXRlPHsgZm9vOiBzdHJpbmcgfT4pIHt9XG4gKiB9XG4gKlxuICogQGRvY3NDYXRlZ29yeSBSeFN0YXRlXG4gKiBAZG9jc1BhZ2UgUnhTdGF0ZVxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUnhTdGF0ZTxTdGF0ZSBleHRlbmRzIG9iamVjdD5cbiAgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIFN1YnNjcmliYWJsZTxTdGF0ZT5cbntcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cbiAgcHJvdGVjdGVkIHNjaGVkdWxlciA9IGluamVjdChSWF9TVEFURV9TQ0hFRFVMRVIsIHsgb3B0aW9uYWw6IHRydWUgfSk7XG5cbiAgcHJpdmF0ZSBhY2N1bXVsYXRvciA9IGNyZWF0ZUFjY3VtdWxhdGlvbk9ic2VydmFibGU8U3RhdGU+KFxuICAgIG5ldyBTdWJqZWN0PE9ic2VydmFibGU8UGFydGlhbDxTdGF0ZT4+PigpLFxuICAgIG5ldyBTdWJqZWN0PFBhcnRpYWw8U3RhdGU+PigpLFxuICAgIG5ldyBCZWhhdmlvclN1YmplY3QoaW5qZWN0KFJYX0FDQ1VNVUxBVE9SX0ZOKSksXG4gICAgdGhpcy5zY2hlZHVsZXIgPT09ICdzeW5jJyA/IG51bGwgOiB0aGlzLnNjaGVkdWxlcixcbiAgKTtcbiAgcHJpdmF0ZSBlZmZlY3RPYnNlcnZhYmxlID0gY3JlYXRlU2lkZUVmZmVjdE9ic2VydmFibGUoXG4gICAgbmV3IFN1YmplY3Q8T2JzZXJ2YWJsZTx1bmtub3duPj4oKSxcbiAgICB0aGlzLnNjaGVkdWxlciA9PT0gJ3N5bmMnID8gbnVsbCA6IHRoaXMuc2NoZWR1bGVyLFxuICApO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgaW5qZWN0b3IgPSBpbmplY3QoSW5qZWN0b3IpO1xuXG4gIHByaXZhdGUgc2lnbmFsU3RvcmVQcm94eTogU2lnbmFsU3RhdGVQcm94eTxTdGF0ZT47XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBUaGUgdW5tb2RpZmllZCBzdGF0ZSBleHBvc2VkIGFzIGBPYnNlcnZhYmxlPFN0YXRlPmAuIEl0IGlzIG5vdCBzaGFyZWQsIGRpc3RpbmN0IG9yIGdldHMgcmVwbGF5ZWQuXG4gICAqIFVzZSB0aGUgYCRgIHByb3BlcnR5IGlmIHlvdSB3YW50IHRvIHJlYWQgdGhlIHN0YXRlIHdpdGhvdXQgaGF2aW5nIGFwcGxpZWQge0BsaW5rIHN0YXRlZnVsfSB0byBpdC5cbiAgICovXG4gIHJlYWRvbmx5ICQ6IE9ic2VydmFibGU8U3RhdGU+ID0gdGhpcy5hY2N1bXVsYXRvci5zaWduYWwkO1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLmFkZCh0aGlzLnN1YnNjcmliZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIFJldHVybiBSeFN0YXRlIGluIFJlYWRPbmx5IG1vZGUgZXhwb3Npbmcgb25seSBtZXRob2RzIGZvciByZWFkaW5nIHN0YXRlXG4gICAqIGdldCgpLCBzZWxlY3QoKSwgY29tcHV0ZWQoKSBhbmQgc2lnbmFsKCkgbWV0aG9kcy5cbiAgICogVGhpcyBjYW4gYmUgaGVscGZ1bCB3aGVuIHlvdSBkb24ndCB3YW50IG90aGVycyB0byB3cml0ZSBpbiB5b3VyIHN0YXRlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGNvbnN0IHJlYWRPbmx5U3RhdGUgPSBzdGF0ZS5hc1JlYWRPbmx5KCk7XG4gICAqIGNvbnN0IGdldE51bSA9IHN0YXRlLmdldCgnbnVtJyk7XG4gICAqIGNvbnN0IHNlbGVjdE51bSQgPSBzdGF0ZS5zZWxlY3QoJ251bScpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHJldHVybiBQaWNrPFJ4U3RhdGU8U3RhdGU+LCBSZWFkT25seT5cbiAgICovXG4gIGFzUmVhZE9ubHkoKTogUGljazxSeFN0YXRlPFN0YXRlPiwgUmVhZE9ubHk+IHtcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0OiB0aGlzLmdldC5iaW5kKHRoaXMpLFxuICAgICAgc2VsZWN0OiB0aGlzLnNlbGVjdC5iaW5kKHRoaXMpLFxuICAgICAgY29tcHV0ZWQ6IHRoaXMuY29tcHV0ZWQuYmluZCh0aGlzKSxcbiAgICAgIHNpZ25hbDogdGhpcy5zaWduYWwuYmluZCh0aGlzKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBBbGxvd3MgdG8gY3VzdG9taXplIHN0YXRlIGFjY3VtdWxhdGlvbiBmdW5jdGlvbi5cbiAgICogVGhpcyBjYW4gYmUgaGVscGZ1bCB0byBpbXBsZW1lbnQgZGVlcCB1cGRhdGVzIGFuZCB0YWNrbGUgb3RoZXIgaW1tdXRhYmlsaXR5IHByb2JsZW1zIGluIGEgY3VzdG9tIHdheS5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBjb25zdCBteUFjY3VtdWxhdG9yID0gKHN0YXRlOiBNeVN0YXRlLCBzbGljZTogUGFydGlhbDxNeVN0YXRlPikgPT4gZGVlcENvcHkoc3RhdGUsIHNsaWNlKTtcbiAgICpcbiAgICogdGhpcy5zdGF0ZS5zZXRBY2N1bXVsYXRvcihteUFjY3VtdWxhdG9yKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSB7QWNjdW11bGF0aW9uRm59IGFjY3VtdWxhdG9yRm5cbiAgICogQHJldHVybiB2b2lkXG4gICAqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqIFVzZSBgcHJvdmlkZVJ4U3RhdGVDb25maWdgIGFuZCBwcm92aWRlIHRoZSBhY2N1bXVsYXRvciB3aXRoIHRoZSBgd2l0aEFjY3VtdWxhdG9yYCBwcm92aWRlciBmdW5jdGlvbi5cbiAgICogV2lsbCBiZSByZW1vdmVkIGluIGZ1dHVyZSB2ZXJzaW9ucy5cbiAgICovXG4gIHNldEFjY3VtdWxhdG9yKGFjY3VtdWxhdG9yRm46IEFjY3VtdWxhdGlvbkZuKTogdm9pZCB7XG4gICAgdGhpcy5hY2N1bXVsYXRvci5uZXh0QWNjdW11bGF0b3IoYWNjdW11bGF0b3JGbik7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFJlYWQgZnJvbSB0aGUgc3RhdGUgaW4gaW1wZXJhdGl2ZSBtYW5uZXIuIFJldHVybnMgdGhlIHN0YXRlIG9iamVjdCBpbiBpdHMgY3VycmVudCBzdGF0ZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogY29uc3QgeyBkaXNhYmxlZCB9ID0gc3RhdGUuZ2V0KCk7XG4gICAqIGlmICghZGlzYWJsZWQpIHtcbiAgICogICBkb1N0dWZmKCk7XG4gICAqIH1cbiAgICpcbiAgICogQHJldHVybiBTdGF0ZVxuICAgKi9cbiAgZ2V0KCk6IFN0YXRlO1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUmVhZCBmcm9tIHRoZSBzdGF0ZSBpbiBpbXBlcmF0aXZlIG1hbm5lciBieSBwcm92aWRpbmcga2V5cyBhcyBwYXJhbWV0ZXJzLlxuICAgKiBSZXR1cm5zIHRoZSBwYXJ0IG9mIHN0YXRlIG9iamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogLy8gQWNjZXNzIGEgc2luZ2xlIHByb3BlcnR5XG4gICAqIGNvbnN0IGJhciA9IHN0YXRlLmdldCgnYmFyJyk7XG4gICAqXG4gICAqIC8vIEFjY2VzcyBhIG5lc3RlZCBwcm9wZXJ0eVxuICAgKiBjb25zdCBmb28gPSBzdGF0ZS5nZXQoJ2JhcicsICdmb28nKTtcbiAgICpcbiAgICogQHBhcmFtIHtLZXlBfSBrZXlBXG4gICAqIEByZXR1cm4gU3RhdGVbS2V5QV1cbiAgICovXG4gIGdldDxLZXlBIGV4dGVuZHMga2V5b2YgU3RhdGU+KGtleUE6IEtleUEpOiBTdGF0ZVtLZXlBXTtcblxuICAvKiogQGludGVybmFsICoqL1xuICBnZXQ8S2V5QSBleHRlbmRzIGtleW9mIFN0YXRlLCBLZXlCIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV0+KFxuICAgIGtleUE6IEtleUEsXG4gICAga2V5QjogS2V5QixcbiAgKTogU3RhdGVbS2V5QV1bS2V5Ql07XG5cbiAgLyoqIEBpbnRlcm5hbCAqKi9cbiAgZ2V0PFxuICAgIEtleUEgZXh0ZW5kcyBrZXlvZiBTdGF0ZSxcbiAgICBLZXlCIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV0sXG4gICAgS2V5QyBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdLFxuICA+KGtleUE6IEtleUEsIGtleUI6IEtleUIsIGtleUM6IEtleUMpOiBTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXTtcblxuICAvKiogQGludGVybmFsICoqL1xuICBnZXQ8XG4gICAgS2V5QSBleHRlbmRzIGtleW9mIFN0YXRlLFxuICAgIEtleUIgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXSxcbiAgICBLZXlDIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql0sXG4gICAgS2V5RCBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdW0tleUNdLFxuICA+KFxuICAgIGtleUE6IEtleUEsXG4gICAga2V5QjogS2V5QixcbiAgICBrZXlDOiBLZXlDLFxuICAgIGtleUQ6IEtleUQsXG4gICk6IFN0YXRlW0tleUFdW0tleUJdW0tleUNdW0tleURdO1xuXG4gIC8qKiBAaW50ZXJuYWwgKiovXG4gIGdldDxcbiAgICBLZXlBIGV4dGVuZHMga2V5b2YgU3RhdGUsXG4gICAgS2V5QiBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdLFxuICAgIEtleUMgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXVtLZXlCXSxcbiAgICBLZXlEIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q10sXG4gICAgS2V5RSBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdW0tleUNdW0tleURdLFxuICA+KFxuICAgIGtleUE6IEtleUEsXG4gICAga2V5QjogS2V5QixcbiAgICBrZXlDOiBLZXlDLFxuICAgIGtleUQ6IEtleUQsXG4gICAga2V5RTogS2V5RSxcbiAgKTogU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q11bS2V5RF1bS2V5RV07XG5cbiAgLyoqIEBpbnRlcm5hbCAqKi9cbiAgZ2V0PFxuICAgIEtleUEgZXh0ZW5kcyBrZXlvZiBTdGF0ZSxcbiAgICBLZXlCIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV0sXG4gICAgS2V5QyBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdLFxuICAgIEtleUQgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXSxcbiAgICBLZXlFIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q11bS2V5RF0sXG4gICAgS2V5RiBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdW0tleUNdW0tleURdW0tleUVdLFxuICA+KFxuICAgIGtleUE6IEtleUEsXG4gICAga2V5QjogS2V5QixcbiAgICBrZXlDOiBLZXlDLFxuICAgIGtleUQ6IEtleUQsXG4gICAga2V5RTogS2V5RSxcbiAgICBrZXlGOiBLZXlGLFxuICApOiBTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXVtLZXlEXVtLZXlFXVtLZXlGXTtcblxuICAvKiogQGludGVybmFsICoqL1xuICBnZXQ8XG4gICAgS2V5QSBleHRlbmRzIGtleW9mIFN0YXRlLFxuICAgIEtleUIgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXSxcbiAgICBLZXlDIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql0sXG4gICAgS2V5RCBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdW0tleUNdLFxuICAgIEtleUUgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXVtLZXlEXSxcbiAgICBLZXlGIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q11bS2V5RF1bS2V5RV0sXG4gID4oXG4gICAgLi4ua2V5czpcbiAgICAgIHwgW0tleUFdXG4gICAgICB8IFtLZXlBLCBLZXlCXVxuICAgICAgfCBbS2V5QSwgS2V5QiwgS2V5Q11cbiAgICAgIHwgW0tleUEsIEtleUIsIEtleUMsIEtleURdXG4gICAgICB8IFtLZXlBLCBLZXlCLCBLZXlDLCBLZXlELCBLZXlFXVxuICAgICAgfCBbS2V5QSwgS2V5QiwgS2V5QywgS2V5RCwgS2V5RSwgS2V5Rl1cbiAgKTpcbiAgICB8IFN0YXRlXG4gICAgfCBTdGF0ZVtLZXlBXVxuICAgIHwgU3RhdGVbS2V5QV1bS2V5Ql1cbiAgICB8IFN0YXRlW0tleUFdW0tleUJdW0tleUNdXG4gICAgfCBTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXVtLZXlEXVxuICAgIHwgU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q11bS2V5RF1bS2V5RV1cbiAgICB8IFN0YXRlW0tleUFdW0tleUJdW0tleUNdW0tleURdW0tleUVdW0tleUZdIHtcbiAgICBjb25zdCBoYXNTdGF0ZUFueUtleXMgPSBPYmplY3Qua2V5cyh0aGlzLmFjY3VtdWxhdG9yLnN0YXRlKS5sZW5ndGggPiAwO1xuICAgIGlmICghIWtleXMgJiYga2V5cy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBzYWZlUGx1Y2sodGhpcy5hY2N1bXVsYXRvci5zdGF0ZSwga2V5cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBoYXNTdGF0ZUFueUtleXNcbiAgICAgICAgPyB0aGlzLmFjY3VtdWxhdG9yLnN0YXRlXG4gICAgICAgIDogKHVuZGVmaW5lZCBhcyB1bmtub3duIGFzIFN0YXRlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIE1hbmlwdWxhdGUgb25lIG9yIG1hbnkgcHJvcGVydGllcyBvZiB0aGUgc3RhdGUgYnkgcHJvdmlkaW5nXG4gICAqIGEgYFBhcnRpYWw8U3RhdGU+YHN0YXRlIG9yIGEgYFByb2plY3Rpb25GdW5jdGlvbjxTdGF0ZT5gLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBVcGRhdGUgb25lIG9yIG1hbnkgcHJvcGVydGllcyBvZiB0aGUgc3RhdGUgYnkgcHJvdmlkaW5nIGEgYFBhcnRpYWw8U3RhdGU+YFxuICAgKlxuICAgKiBjb25zdCBwYXJ0aWFsU3RhdGUgPSB7XG4gICAqICAgZm9vOiAnYmFyJyxcbiAgICogICBiYXI6IDVcbiAgICogfTtcbiAgICogc3RhdGUuc2V0KHBhcnRpYWxTdGF0ZSk7XG4gICAqXG4gICAqIC8vIFVwZGF0ZSBvbmUgb3IgbWFueSBwcm9wZXJ0aWVzIG9mIHRoZSBzdGF0ZSBieSBwcm92aWRpbmcgYSBgUHJvamVjdGlvbkZ1bmN0aW9uPFN0YXRlPmBcbiAgICpcbiAgICogY29uc3QgcmVkdWNlRm4gPSBvbGRTdGF0ZSA9PiAoe1xuICAgKiAgIGJhcjogb2xkU3RhdGUuYmFyICsgNVxuICAgKiB9KTtcbiAgICogc3RhdGUuc2V0KHJlZHVjZUZuKTtcbiAgICpcbiAgICogQHBhcmFtIHtQYXJ0aWFsPFN0YXRlPnxQcm9qZWN0U3RhdGVGbjxTdGF0ZT59IHN0YXRlT3JQcm9qZWN0U3RhdGVcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICBzZXQoc3RhdGVPclByb2plY3RTdGF0ZTogUGFydGlhbDxTdGF0ZT4gfCBQcm9qZWN0U3RhdGVGbjxTdGF0ZT4pOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogTWFuaXB1bGF0ZSBhIHNpbmdsZSBwcm9wZXJ0eSBvZiB0aGUgc3RhdGUgYnkgdGhlIHByb3BlcnR5IG5hbWUgYW5kIGEgYFByb2plY3Rpb25GdW5jdGlvbjxTdGF0ZT5gLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCByZWR1Y2VGbiA9IG9sZFN0YXRlID0+IG9sZFN0YXRlLmJhciArIDU7XG4gICAqIHN0YXRlLnNldCgnYmFyJywgcmVkdWNlRm4pO1xuICAgKlxuICAgKiBAcGFyYW0ge0tleX0ga2V5XG4gICAqIEBwYXJhbSB7UHJvamVjdFZhbHVlRm48U3RhdGUsIEtleT59IHByb2plY3RTbGljZVxuICAgKiBAcmV0dXJuIHZvaWRcbiAgICovXG4gIHNldDxLZXkgZXh0ZW5kcyBrZXlvZiBTdGF0ZSwgT2JqZWN0PihcbiAgICBrZXk6IEtleSxcbiAgICBwcm9qZWN0U2xpY2U6IFByb2plY3RWYWx1ZUZuPFN0YXRlLCBLZXk+LFxuICApOiB2b2lkO1xuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZXQ8S2V5IGV4dGVuZHMga2V5b2YgU3RhdGU+KFxuICAgIGtleU9yU3RhdGVPclByb2plY3RTdGF0ZTogUGFydGlhbDxTdGF0ZT4gfCBQcm9qZWN0U3RhdGVGbjxTdGF0ZT4gfCBLZXksXG4gICAgc3RhdGVPclNsaWNlUHJvamVjdEZuPzogUHJvamVjdFZhbHVlRm48U3RhdGUsIEtleT4sXG4gICk6IHZvaWQge1xuICAgIGlmIChcbiAgICAgIHR5cGVvZiBrZXlPclN0YXRlT3JQcm9qZWN0U3RhdGUgPT09ICdvYmplY3QnICYmXG4gICAgICBzdGF0ZU9yU2xpY2VQcm9qZWN0Rm4gPT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgdGhpcy5hY2N1bXVsYXRvci5uZXh0U2xpY2Uoa2V5T3JTdGF0ZU9yUHJvamVjdFN0YXRlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICB0eXBlb2Yga2V5T3JTdGF0ZU9yUHJvamVjdFN0YXRlID09PSAnZnVuY3Rpb24nICYmXG4gICAgICBzdGF0ZU9yU2xpY2VQcm9qZWN0Rm4gPT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgdGhpcy5hY2N1bXVsYXRvci5uZXh0U2xpY2UoXG4gICAgICAgIGtleU9yU3RhdGVPclByb2plY3RTdGF0ZSh0aGlzLmFjY3VtdWxhdG9yLnN0YXRlKSxcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgaXNLZXlPZjxTdGF0ZT4oa2V5T3JTdGF0ZU9yUHJvamVjdFN0YXRlKSAmJlxuICAgICAgdHlwZW9mIHN0YXRlT3JTbGljZVByb2plY3RGbiA9PT0gJ2Z1bmN0aW9uJ1xuICAgICkge1xuICAgICAgY29uc3Qgc3RhdGU6IFBhcnRpYWw8U3RhdGU+ID0ge307XG4gICAgICBzdGF0ZVtrZXlPclN0YXRlT3JQcm9qZWN0U3RhdGVdID0gc3RhdGVPclNsaWNlUHJvamVjdEZuKFxuICAgICAgICB0aGlzLmFjY3VtdWxhdG9yLnN0YXRlLFxuICAgICAgKTtcbiAgICAgIHRoaXMuYWNjdW11bGF0b3IubmV4dFNsaWNlKHN0YXRlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3dyb25nIHBhcmFtcyBwYXNzZWQgdG8gc2V0Jyk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIENvbm5lY3QgYW4gYE9ic2VydmFibGU8UGFydGlhbDxTdGF0ZT4+YCB0byB0aGUgc3RhdGUgYFN0YXRlYC5cbiAgICogQW55IGNoYW5nZSBlbWl0dGVkIGJ5IHRoZSBzb3VyY2Ugd2lsbCBnZXQgbWVyZ2VkIGludG8gdGhlIHN0YXRlLlxuICAgKiBTdWJzY3JpcHRpb24gaGFuZGxpbmcgaXMgZG9uZSBhdXRvbWF0aWNhbGx5LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBzbGljZVRvQWRkJCA9IGludGVydmFsKDI1MCkucGlwZShtYXBUbyh7XG4gICAqICAgYmFyOiA1LFxuICAgKiAgIGZvbzogJ2ZvbydcbiAgICogfSk7XG4gICAqIHN0YXRlLmNvbm5lY3Qoc2xpY2VUb0FkZCQpO1xuICAgKiAvLyBldmVyeSAyNTBtcyB0aGUgcHJvcGVydGllcyBiYXIgYW5kIGZvbyBnZXQgdXBkYXRlZCBkdWUgdG8gdGhlIGVtaXNzaW9uIG9mIHNsaWNlVG9BZGQkXG4gICAqXG4gICAqIC8vIEFkZGl0aW9uYWxseSB5b3UgY2FuIHByb3ZpZGUgYSBgcHJvamVjdGlvbkZ1bmN0aW9uYCB0byBhY2Nlc3MgdGhlIGN1cnJlbnQgc3RhdGUgb2JqZWN0IGFuZCBkbyBjdXN0b20gbWFwcGluZ3MuXG4gICAqXG4gICAqIGNvbnN0IHNsaWNlVG9BZGQkID0gaW50ZXJ2YWwoMjUwKS5waXBlKG1hcFRvKHtcbiAgICogICBiYXI6IDUsXG4gICAqICAgZm9vOiAnZm9vJ1xuICAgKiB9KTtcbiAgICogc3RhdGUuY29ubmVjdChzbGljZVRvQWRkJCwgKHN0YXRlLCBzbGljZSkgPT4gc3RhdGUuYmFyICs9IHNsaWNlLmJhcik7XG4gICAqIC8vIGV2ZXJ5IDI1MG1zIHRoZSBwcm9wZXJ0aWVzIGJhciBhbmQgZm9vIGdldCB1cGRhdGVkIGR1ZSB0byB0aGUgZW1pc3Npb24gb2Ygc2xpY2VUb0FkZCQuIEJhciB3aWxsIGluY3JlYXNlIGJ5XG4gICAqIC8vIDUgZHVlIHRvIHRoZSBwcm9qZWN0aW9uRnVuY3Rpb25cbiAgICpcbiAgICogIEBwYXJhbSB7T2JzZXJ2YWJsZTxQYXJ0aWFsPFN0YXRlPj59IGlucHV0T3JTbGljZSRcbiAgICogIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgY29ubmVjdChpbnB1dE9yU2xpY2UkOiBPYnNlcnZhYmxlPFBhcnRpYWw8U3RhdGU+Pik6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBDb25uZWN0IGEgYFNpZ25hbDxQYXJ0aWFsPFN0YXRlPj5gIHRvIHRoZSBzdGF0ZSBgU3RhdGVgLlxuICAgKiBBbnkgY2hhbmdlIGVtaXR0ZWQgYnkgdGhlIHNvdXJjZSB3aWxsIGdldCBtZXJnZWQgaW50byB0aGUgc3RhdGUuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGNvbnN0IHBhcnRpYWxTdGF0ZSA9IHNpZ25hbCh7IGZvbzogJ2ZvbycsIGJhcjogNSB9KTtcbiAgICogc3RhdGUuY29ubmVjdChwYXJ0aWFsU3RhdGUpO1xuICAgKlxuICAgKiAgQHBhcmFtIHtTaWduYWw8UGFydGlhbDxTdGF0ZT4+fSBzaWduYWxcbiAgICogIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgY29ubmVjdChzaWduYWw6IFNpZ25hbDxQYXJ0aWFsPFN0YXRlPj4pOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogQ29ubmVjdCBhbiBgT2JzZXJ2YWJsZTxWYWx1ZT5gIHRvIHRoZSBzdGF0ZSBgU3RhdGVgLlxuICAgKiBBbnkgY2hhbmdlIGVtaXR0ZWQgYnkgdGhlIHNvdXJjZSB3aWxsIGdldCBmb3J3YXJkZWQgdG8gcHJvamVjdCBmdW5jdGlvbiBhbmQgbWVyZ2VkIGludG8gdGhlIHN0YXRlLlxuICAgKiBTdWJzY3JpcHRpb24gaGFuZGxpbmcgaXMgZG9uZSBhdXRvbWF0aWNhbGx5LlxuICAgKlxuICAgKiBZb3UgaGF2ZSB0byBwcm92aWRlIGEgYHByb2plY3Rpb25GdW5jdGlvbmAgdG8gYWNjZXNzIHRoZSBjdXJyZW50IHN0YXRlIG9iamVjdCBhbmQgZG8gY3VzdG9tIG1hcHBpbmdzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBzbGljZVRvQWRkJCA9IGludGVydmFsKDI1MCk7XG4gICAqIHN0YXRlLmNvbm5lY3Qoc2xpY2VUb0FkZCQsICh0eXBlLCB2YWx1ZSkgPT4gKHtiYXI6IHZhbHVlfSkpO1xuICAgKiAvLyBldmVyeSAyNTBtcyB0aGUgcHJvcGVydHkgYmFyIGdldCB1cGRhdGVkIGR1ZSB0byB0aGUgZW1pc3Npb24gb2Ygc2xpY2VUb0FkZCRcbiAgICpcbiAgICogQHBhcmFtIHtPYnNlcnZhYmxlPFZhbHVlPn0gaW5wdXRPclNsaWNlJFxuICAgKiBAcGFyYW0ge1Byb2plY3RTdGF0ZVJlZHVjZXI8U3RhdGUsIFZhbHVlPn0gcHJvamVjdEZuXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgY29ubmVjdDxWYWx1ZT4oXG4gICAgaW5wdXRPclNsaWNlJDogT2JzZXJ2YWJsZTxWYWx1ZT4sXG4gICAgcHJvamVjdEZuOiBQcm9qZWN0U3RhdGVSZWR1Y2VyPFN0YXRlLCBWYWx1ZT4sXG4gICk6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBDb25uZWN0IGEgYFNpZ25hbDxWYWx1ZT5gIHRvIHRoZSBzdGF0ZSBgU3RhdGVgLlxuICAgKiBBbnkgY2hhbmdlIGVtaXR0ZWQgYnkgdGhlIHNvdXJjZSB3aWxsIGdldCBmb3J3YXJkZWQgdG8gdGhlIHByb2plY3QgZnVuY3Rpb24gYW5kIG1lcmdlZCBpbnRvIHRoZSBzdGF0ZS5cbiAgICpcbiAgICogWW91IGhhdmUgdG8gcHJvdmlkZSBhIGBwcm9qZWN0aW9uRnVuY3Rpb25gIHRvIGFjY2VzcyB0aGUgY3VycmVudCBzdGF0ZSBvYmplY3QgYW5kIGRvIGN1c3RvbSBtYXBwaW5ncy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogY29uc3Qgc2lnbmFsU2xpY2UgPSBzaWduYWwoNSk7XG4gICAqIHN0YXRlLmNvbm5lY3Qoc2lnbmFsU2xpY2UsICh0eXBlLCB2YWx1ZSkgPT4gKHtiYXI6IHZhbHVlfSkpO1xuICAgKlxuICAgKiBAcGFyYW0ge1NpZ25hbDxWYWx1ZT59IHNpZ25hbFxuICAgKiBAcGFyYW0ge1Byb2plY3RTdGF0ZVJlZHVjZXI8U3RhdGUsIFZhbHVlPn0gcHJvamVjdEZuXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgY29ubmVjdDxWYWx1ZT4oXG4gICAgc2lnbmFsOiBTaWduYWw8VmFsdWU+LFxuICAgIHByb2plY3RGbjogUHJvamVjdFN0YXRlUmVkdWNlcjxTdGF0ZSwgVmFsdWU+LFxuICApOiB2b2lkO1xuXG4gIC8qKlxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogQ29ubmVjdCBhbiBgT2JzZXJ2YWJsZTxTdGF0ZVtLZXldPmAgc291cmNlIHRvIGEgc3BlY2lmaWMgcHJvcGVydHkgYEtleWAgaW4gdGhlIHN0YXRlIGBTdGF0ZWAuXG4gICAqIEFueSBlbWl0dGVkIGNoYW5nZSB3aWxsIHVwZGF0ZSB0aGlzIHNwZWNpZmljIHByb3BlcnR5IGluIHRoZSBzdGF0ZS5cbiAgICogU3Vic2NyaXB0aW9uIGhhbmRsaW5nIGlzIGRvbmUgYXV0b21hdGljYWxseS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogY29uc3QgbXlUaW1lciQgPSBpbnRlcnZhbCgyNTApO1xuICAgKiBzdGF0ZS5jb25uZWN0KCd0aW1lcicsIG15VGltZXIkKTtcbiAgICogLy8gZXZlcnkgMjUwbXMgdGhlIHByb3BlcnR5IHRpbWVyIHdpbGwgZ2V0IHVwZGF0ZWRcbiAgICogQHBhcmFtIHtLZXl9IGtleVxuICAgKiBAcGFyYW0ge09ic2VydmFibGU8U3RhdGVbS2V5XT59IHNsaWNlJFxuICAgKlxuICAgKiBAcmV0dXJuIHZvaWRcbiAgICovXG4gIGNvbm5lY3Q8S2V5IGV4dGVuZHMga2V5b2YgU3RhdGU+KFxuICAgIGtleTogS2V5LFxuICAgIHNsaWNlJDogT2JzZXJ2YWJsZTxTdGF0ZVtLZXldPixcbiAgKTogdm9pZDtcblxuICAvKipcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIENvbm5lY3QgYSBgU2lnbmFsPFN0YXRlW0tleV0+YCBzb3VyY2UgdG8gYSBzcGVjaWZpYyBwcm9wZXJ0eSBgS2V5YCBpbiB0aGUgc3RhdGUgYFN0YXRlYC5cbiAgICogQW55IGVtaXR0ZWQgY2hhbmdlIHdpbGwgdXBkYXRlIHRoaXMgc3BlY2lmaWMgcHJvcGVydHkgaW4gdGhlIHN0YXRlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBjdXJyZW50VGltZSA9IHNpZ25hbChEYXRlLm5vdygpKVxuICAgKiBzdGF0ZS5jb25uZWN0KCdjdXJyZW50VGltZScsIGN1cnJlbnRUaW1lKTtcbiAgICpcbiAgICogQHBhcmFtIHtLZXl9IGtleVxuICAgKiBAcGFyYW0ge1NpZ25hbDxTdGF0ZVtLZXldPn0gc2lnbmFsXG4gICAqXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgY29ubmVjdDxLZXkgZXh0ZW5kcyBrZXlvZiBTdGF0ZT4oa2V5OiBLZXksIHNpZ25hbDogU2lnbmFsPFN0YXRlW0tleV0+KTogdm9pZDtcblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIENvbm5lY3QgYW4gYE9ic2VydmFibGU8VmFsdWU+YCBzb3VyY2UgdG8gYSBzcGVjaWZpYyBwcm9wZXJ0eSBpbiB0aGUgc3RhdGUuIEFkZGl0aW9uYWxseSwgeW91IGNhbiBwcm92aWRlIGFcbiAgICogYHByb2plY3Rpb25GdW5jdGlvbmAgdG8gYWNjZXNzIHRoZSBjdXJyZW50IHN0YXRlIG9iamVjdCBvbiBldmVyeSBlbWlzc2lvbiBvZiB5b3VyIGNvbm5lY3RlZCBgT2JzZXJ2YWJsZWAuXG4gICAqIEFueSBjaGFuZ2UgZW1pdHRlZCBieSB0aGUgc291cmNlIHdpbGwgZ2V0IG1lcmdlZCBpbnRvIHRoZSBzdGF0ZS5cbiAgICogU3Vic2NyaXB0aW9uIGhhbmRsaW5nIGlzIGRvbmUgYXV0b21hdGljYWxseS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogY29uc3QgbXlUaW1lciQgPSBpbnRlcnZhbCgyNTApO1xuICAgKiBzdGF0ZS5jb25uZWN0KCd0aW1lcicsIG15VGltZXIkLCAoc3RhdGUsIHRpbWVyQ2hhbmdlKSA9PiBzdGF0ZS50aW1lciArPSB0aW1lckNoYW5nZSk7XG4gICAqIC8vIGV2ZXJ5IDI1MG1zIHRoZSBwcm9wZXJ0eSB0aW1lciB3aWxsIGdldCB1cGRhdGVkXG4gICAqXG4gICAqIEBwYXJhbSB7S2V5fSBrZXlcbiAgICogQHBhcmFtIHtPYnNlcnZhYmxlPFZhbHVlPn0gaW5wdXQkXG4gICAqIEBwYXJhbSB7UHJvamVjdFZhbHVlUmVkdWNlcjxTdGF0ZSwgS2V5LCBWYWx1ZT59IHByb2plY3RTbGljZUZuXG4gICAqXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgY29ubmVjdDxLZXkgZXh0ZW5kcyBrZXlvZiBTdGF0ZSwgVmFsdWU+KFxuICAgIGtleTogS2V5LFxuICAgIGlucHV0JDogT2JzZXJ2YWJsZTxWYWx1ZT4sXG4gICAgcHJvamVjdFNsaWNlRm46IFByb2plY3RWYWx1ZVJlZHVjZXI8U3RhdGUsIEtleSwgVmFsdWU+LFxuICApOiB2b2lkO1xuXG4gIC8qKlxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogQ29ubmVjdCBhIGBTaWduYWw8VmFsdWU+YCBzb3VyY2UgdG8gYSBzcGVjaWZpYyBwcm9wZXJ0eSBpbiB0aGUgc3RhdGUuIEFkZGl0aW9uYWxseSwgeW91IGNhbiBwcm92aWRlIGFcbiAgICogYHByb2plY3Rpb25GdW5jdGlvbmAgdG8gYWNjZXNzIHRoZSBjdXJyZW50IHN0YXRlIG9iamVjdCBvbiBldmVyeSBlbWlzc2lvbiBvZiB5b3VyIGNvbm5lY3RlZCBgT2JzZXJ2YWJsZWAuXG4gICAqIEFueSBjaGFuZ2UgZW1pdHRlZCBieSB0aGUgc291cmNlIHdpbGwgZ2V0IG1lcmdlZCBpbnRvIHRoZSBzdGF0ZS5cbiAgICogU3Vic2NyaXB0aW9uIGhhbmRsaW5nIGlzIGRvbmUgYXV0b21hdGljYWxseS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogY29uc3QgY3VycmVudFRpbWUgPSBzaWduYWwoRGF0ZS5ub3coKSlcbiAgICogc3RhdGUuY29ubmVjdCgnY3VycmVudFRpbWUnLCBjdXJyZW50VGltZSwgKHN0YXRlLCBjdXJyZW50VGltZSkgPT4gc3RhdGUuY3VycmVudFRpbWUgPSBjdXJyZW50VGltZSk7XG4gICAqXG4gICAqIEBwYXJhbSB7S2V5fSBrZXlcbiAgICogQHBhcmFtIHtTaWduYWw8VmFsdWU+fSBzaWduYWxcbiAgICogQHBhcmFtIHtQcm9qZWN0VmFsdWVSZWR1Y2VyPFN0YXRlLCBLZXksIFZhbHVlPn0gcHJvamVjdFNsaWNlRm5cbiAgICpcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICBjb25uZWN0PEtleSBleHRlbmRzIGtleW9mIFN0YXRlLCBWYWx1ZT4oXG4gICAga2V5OiBLZXksXG4gICAgc2lnbmFsOiBTaWduYWw8VmFsdWU+LFxuICAgIHByb2plY3RTbGljZUZuOiBQcm9qZWN0VmFsdWVSZWR1Y2VyPFN0YXRlLCBLZXksIFZhbHVlPixcbiAgKTogdm9pZDtcblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25uZWN0PEtleSBleHRlbmRzIGtleW9mIFN0YXRlLCBWYWx1ZSBleHRlbmRzIFBhcnRpYWw8U3RhdGU+PihcbiAgICBrZXlPcklucHV0T3JTbGljZSQ6XG4gICAgICB8IEtleVxuICAgICAgfCBPYnNlcnZhYmxlPFBhcnRpYWw8U3RhdGU+IHwgVmFsdWU+XG4gICAgICB8IFNpZ25hbDxQYXJ0aWFsPFN0YXRlPiB8IFZhbHVlPixcbiAgICBwcm9qZWN0T3JTbGljZXMkPzpcbiAgICAgIHwgUHJvamVjdFN0YXRlUmVkdWNlcjxTdGF0ZSwgVmFsdWU+XG4gICAgICB8IE9ic2VydmFibGU8U3RhdGVbS2V5XSB8IFZhbHVlPlxuICAgICAgfCBTaWduYWw8U3RhdGVbS2V5XSB8IFZhbHVlPixcbiAgICBwcm9qZWN0VmFsdWVGbj86IFByb2plY3RWYWx1ZVJlZHVjZXI8U3RhdGUsIEtleSwgVmFsdWU+LFxuICApOiB2b2lkIHtcbiAgICAvKipcbiAgICAgKiBGcm9tIHRvcCB0byBib3R0b20gdGhlIG92ZXJsb2FkcyBhcmUgaGFuZGxlZC5cbiAgICAgKi9cbiAgICBpZiAoXG4gICAgICBpc09ic2VydmFibGUoa2V5T3JJbnB1dE9yU2xpY2UkKSAmJlxuICAgICAgIXByb2plY3RPclNsaWNlcyQgJiZcbiAgICAgICFwcm9qZWN0VmFsdWVGblxuICAgICkge1xuICAgICAgdGhpcy5hY2N1bXVsYXRvci5uZXh0U2xpY2VPYnNlcnZhYmxlKGtleU9ySW5wdXRPclNsaWNlJCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGlzU2lnbmFsKGtleU9ySW5wdXRPclNsaWNlJCkgJiYgIXByb2plY3RPclNsaWNlcyQgJiYgIXByb2plY3RWYWx1ZUZuKSB7XG4gICAgICB0aGlzLmFjY3VtdWxhdG9yLm5leHRTbGljZU9ic2VydmFibGUoXG4gICAgICAgIHRvT2JzZXJ2YWJsZShrZXlPcklucHV0T3JTbGljZSQsIHsgaW5qZWN0b3I6IHRoaXMuaW5qZWN0b3IgfSksXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGlzT2JzZXJ2YWJsZShrZXlPcklucHV0T3JTbGljZSQpICYmXG4gICAgICBwcm9qZWN0T3JTbGljZXMkICYmXG4gICAgICB0eXBlb2YgcHJvamVjdE9yU2xpY2VzJCA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgIXByb2plY3RWYWx1ZUZuXG4gICAgKSB7XG4gICAgICBjb25zdCBwcm9qZWN0aW9uU3RhdGVGbiA9IHByb2plY3RPclNsaWNlcyQ7XG4gICAgICBjb25zdCBzbGljZSQgPSBrZXlPcklucHV0T3JTbGljZSQucGlwZShcbiAgICAgICAgbWFwKCh2KSA9PiBwcm9qZWN0aW9uU3RhdGVGbih0aGlzLmFjY3VtdWxhdG9yLnN0YXRlLCB2IGFzIFZhbHVlKSksXG4gICAgICApO1xuICAgICAgdGhpcy5hY2N1bXVsYXRvci5uZXh0U2xpY2VPYnNlcnZhYmxlKHNsaWNlJCBhcyBPYnNlcnZhYmxlPFZhbHVlPik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgaXNTaWduYWwoa2V5T3JJbnB1dE9yU2xpY2UkKSAmJlxuICAgICAgcHJvamVjdE9yU2xpY2VzJCAmJlxuICAgICAgdHlwZW9mIHByb2plY3RPclNsaWNlcyQgPT09ICdmdW5jdGlvbicgJiZcbiAgICAgICFwcm9qZWN0VmFsdWVGblxuICAgICkge1xuICAgICAgY29uc3QgcHJvamVjdGlvblN0YXRlRm4gPSBwcm9qZWN0T3JTbGljZXMkO1xuICAgICAgY29uc3Qgc2xpY2UkID0gdG9PYnNlcnZhYmxlKGtleU9ySW5wdXRPclNsaWNlJCwge1xuICAgICAgICBpbmplY3RvcjogdGhpcy5pbmplY3RvcixcbiAgICAgIH0pLnBpcGUoXG4gICAgICAgIG1hcCgodikgPT4gcHJvamVjdGlvblN0YXRlRm4odGhpcy5hY2N1bXVsYXRvci5zdGF0ZSwgdiBhcyBWYWx1ZSkpLFxuICAgICAgKTtcbiAgICAgIHRoaXMuYWNjdW11bGF0b3IubmV4dFNsaWNlT2JzZXJ2YWJsZShzbGljZSQgYXMgT2JzZXJ2YWJsZTxWYWx1ZT4pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGlzS2V5T2Y8U3RhdGU+KGtleU9ySW5wdXRPclNsaWNlJCkgJiZcbiAgICAgIGlzT2JzZXJ2YWJsZShwcm9qZWN0T3JTbGljZXMkKSAmJlxuICAgICAgIXByb2plY3RWYWx1ZUZuXG4gICAgKSB7XG4gICAgICBjb25zdCBzbGljZSQgPSBwcm9qZWN0T3JTbGljZXMkLnBpcGUoXG4gICAgICAgIG1hcCgodmFsdWUpID0+ICh7IC4uLnt9LCBba2V5T3JJbnB1dE9yU2xpY2UkXTogdmFsdWUgfSkpLFxuICAgICAgKTtcbiAgICAgIHRoaXMuYWNjdW11bGF0b3IubmV4dFNsaWNlT2JzZXJ2YWJsZShzbGljZSQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGlzS2V5T2Y8U3RhdGU+KGtleU9ySW5wdXRPclNsaWNlJCkgJiZcbiAgICAgIGlzU2lnbmFsKHByb2plY3RPclNsaWNlcyQpICYmXG4gICAgICAhcHJvamVjdFZhbHVlRm5cbiAgICApIHtcbiAgICAgIGNvbnN0IHNsaWNlJCA9IHRvT2JzZXJ2YWJsZShwcm9qZWN0T3JTbGljZXMkLCB7XG4gICAgICAgIGluamVjdG9yOiB0aGlzLmluamVjdG9yLFxuICAgICAgfSkucGlwZShtYXAoKHZhbHVlKSA9PiAoeyAuLi57fSwgW2tleU9ySW5wdXRPclNsaWNlJF06IHZhbHVlIH0pKSk7XG4gICAgICB0aGlzLmFjY3VtdWxhdG9yLm5leHRTbGljZU9ic2VydmFibGUoc2xpY2UkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBwcm9qZWN0VmFsdWVGbiAmJlxuICAgICAgdHlwZW9mIHByb2plY3RWYWx1ZUZuID09PSAnZnVuY3Rpb24nICYmXG4gICAgICBpc0tleU9mPFN0YXRlPihrZXlPcklucHV0T3JTbGljZSQpICYmXG4gICAgICBpc09ic2VydmFibGUocHJvamVjdE9yU2xpY2VzJClcbiAgICApIHtcbiAgICAgIGNvbnN0IGtleTogS2V5ID0ga2V5T3JJbnB1dE9yU2xpY2UkO1xuICAgICAgY29uc3Qgc2xpY2UkID0gcHJvamVjdE9yU2xpY2VzJC5waXBlKFxuICAgICAgICBtYXAoKHZhbHVlKSA9PiAoe1xuICAgICAgICAgIC4uLnt9LFxuICAgICAgICAgIFtrZXldOiBwcm9qZWN0VmFsdWVGbih0aGlzLmdldCgpLCB2YWx1ZSBhcyBWYWx1ZSksXG4gICAgICAgIH0pKSxcbiAgICAgICk7XG4gICAgICB0aGlzLmFjY3VtdWxhdG9yLm5leHRTbGljZU9ic2VydmFibGUoc2xpY2UkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBwcm9qZWN0VmFsdWVGbiAmJlxuICAgICAgdHlwZW9mIHByb2plY3RWYWx1ZUZuID09PSAnZnVuY3Rpb24nICYmXG4gICAgICBpc0tleU9mKGtleU9ySW5wdXRPclNsaWNlJCkgJiZcbiAgICAgIGlzU2lnbmFsKHByb2plY3RPclNsaWNlcyQpXG4gICAgKSB7XG4gICAgICBjb25zdCBrZXk6IEtleSA9IGtleU9ySW5wdXRPclNsaWNlJDtcbiAgICAgIGNvbnN0IHNsaWNlJCA9IHRvT2JzZXJ2YWJsZShwcm9qZWN0T3JTbGljZXMkLCB7XG4gICAgICAgIGluamVjdG9yOiB0aGlzLmluamVjdG9yLFxuICAgICAgfSkucGlwZShcbiAgICAgICAgbWFwKCh2YWx1ZSkgPT4gKHtcbiAgICAgICAgICAuLi57fSxcbiAgICAgICAgICBba2V5XTogcHJvamVjdFZhbHVlRm4odGhpcy5nZXQoKSwgdmFsdWUgYXMgVmFsdWUpLFxuICAgICAgICB9KSksXG4gICAgICApO1xuICAgICAgdGhpcy5hY2N1bXVsYXRvci5uZXh0U2xpY2VPYnNlcnZhYmxlKHNsaWNlJCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKCd3cm9uZyBwYXJhbXMgcGFzc2VkIHRvIGNvbm5lY3QnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUmV0dXJucyB0aGUgc3RhdGUgYXMgY2FjaGVkIGFuZCBkaXN0aW5jdCBgT2JzZXJ2YWJsZTxUeXBlPmAuXG4gICAqIFRoaXMgd2F5IHlvdSBkb24ndCBoYXZlIHRvIHRoaW5rIGFib3V0XG4gICAqICoqbGF0ZSBzdWJzY3JpYmVycyoqLCAqKm11bHRpcGxlIHN1YnNjcmliZXJzKiogb3IgKiptdWx0aXBsZSBlbWlzc2lvbnMqKiBvZiB0aGUgc2FtZSB2YWx1ZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBzdGF0ZSQgPSBzdGF0ZS5zZWxlY3QoKTtcbiAgICogc3RhdGUkLnN1YnNjcmliZShzdGF0ZSA9PiBkb1N0dWZmKHN0YXRlKSk7XG4gICAqXG4gICAqIEByZXR1cm5zIE9ic2VydmFibGU8VFR5cGU+XG4gICAqL1xuICBzZWxlY3QoKTogT2JzZXJ2YWJsZTxTdGF0ZT47XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBSZXR1cm5zIHRoZSBzdGF0ZSBhcyBjYWNoZWQgYW5kIGRpc3RpbmN0IGBPYnNlcnZhYmxlPFR5cGVBPmAuIEFjY2VwdHMgYXJiaXRyYXJ5XG4gICAqIFtyeGpzIG9wZXJhdG9yc10oaHR0cHM6Ly9yeGpzLWRldi5maXJlYmFzZWFwcC5jb20vZ3VpZGUvb3BlcmF0b3JzKVxuICAgKiB0byBlbnJpY2ggdGhlIHNlbGVjdGlvbiB3aXRoIHJlYWN0aXZlIGNvbXBvc2l0aW9uLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBwcm9maWxlUGljdHVyZSQgPSBzdGF0ZS5zZWxlY3QoXG4gICAqICBtYXAoKHN0YXRlKSA9PiBzdGF0ZS5wcm9maWxlUGljdHVyZSksXG4gICAqICBzd2l0Y2hNYXAocHJvZmlsZVBpY3R1cmUgPT4gbWFwSW1hZ2VBc3luYyhwcm9maWxlUGljdHVyZSkpXG4gICAqICk7XG4gICAqIEBwYXJhbSBvcCB7IE9wZXJhdG9yRnVuY3Rpb248VHlwZSwgVHlwZUE+IH1cbiAgICogQHJldHVybnMgT2JzZXJ2YWJsZTxUeXBlQT5cbiAgICovXG4gIHNlbGVjdDxUeXBlQSA9IFN0YXRlPihvcDogT3BlcmF0b3JGdW5jdGlvbjxTdGF0ZSwgVHlwZUE+KTogT2JzZXJ2YWJsZTxUeXBlQT47XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2VsZWN0PFR5cGVBID0gU3RhdGUsIFR5cGVCID0gVHlwZUE+KFxuICAgIG9wMTogT3BlcmF0b3JGdW5jdGlvbjxTdGF0ZSwgVHlwZUE+LFxuICAgIG9wMjogT3BlcmF0b3JGdW5jdGlvbjxUeXBlQSwgVHlwZUI+LFxuICApOiBPYnNlcnZhYmxlPFR5cGVCPjtcblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZWxlY3Q8VHlwZUEgPSBTdGF0ZSwgVHlwZUIgPSBUeXBlQSwgVHlwZUMgPSBUeXBlQj4oXG4gICAgb3AxOiBPcGVyYXRvckZ1bmN0aW9uPFN0YXRlLCBUeXBlQT4sXG4gICAgb3AyOiBPcGVyYXRvckZ1bmN0aW9uPFR5cGVBLCBUeXBlQj4sXG4gICAgb3AzOiBPcGVyYXRvckZ1bmN0aW9uPFR5cGVCLCBUeXBlQz4sXG4gICk6IE9ic2VydmFibGU8VHlwZUM+O1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNlbGVjdDxUeXBlQSA9IFN0YXRlLCBUeXBlQiA9IFR5cGVBLCBUeXBlQyA9IFR5cGVCLCBUeXBlRCA9IFR5cGVDPihcbiAgICBvcDE6IE9wZXJhdG9yRnVuY3Rpb248U3RhdGUsIFR5cGVBPixcbiAgICBvcDI6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUEsIFR5cGVCPixcbiAgICBvcDM6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUIsIFR5cGVDPixcbiAgICBvcDQ6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUMsIFR5cGVEPixcbiAgKTogT2JzZXJ2YWJsZTxUeXBlRD47XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2VsZWN0PFxuICAgIFR5cGVBID0gU3RhdGUsXG4gICAgVHlwZUIgPSBUeXBlQSxcbiAgICBUeXBlQyA9IFR5cGVCLFxuICAgIFR5cGVEID0gVHlwZUMsXG4gICAgVHlwZUUgPSBUeXBlRCxcbiAgPihcbiAgICBvcDE6IE9wZXJhdG9yRnVuY3Rpb248U3RhdGUsIFR5cGVBPixcbiAgICBvcDI6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUEsIFR5cGVCPixcbiAgICBvcDM6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUIsIFR5cGVDPixcbiAgICBvcDQ6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUMsIFR5cGVEPixcbiAgICBvcDU6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUQsIFR5cGVFPixcbiAgKTogT2JzZXJ2YWJsZTxUeXBlRT47XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBUcmFuc2Zvcm0gYSBzbGljZSBvZiB0aGUgc3RhdGUgYnkgcHJvdmlkaW5nIGtleXMgYW5kIG1hcCBmdW5jdGlvbi5cbiAgICogUmV0dXJucyByZXN1bHQgb2YgYXBwbHlpbmcgZnVuY3Rpb24gdG8gc3RhdGUgc2xpY2UgYXMgY2FjaGVkIGFuZCBkaXN0aW5jdCBgT2JzZXJ2YWJsZTxWYWx1ZT5gLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBQcm9qZWN0IHN0YXRlIHNsaWNlXG4gICAqIGNvbnN0IHRleHQkID0gc3RhdGUuc2VsZWN0KFxuICAgKiAgIFsncXVlcnknLCAncmVzdWx0cyddLFxuICAgKiAgICh7IHF1ZXJ5LCByZXN1bHRzIH0pID0+IGAke3Jlc3VsdHMubGVuZ3RofSByZXN1bHRzIGZvdW5kIGZvciBcIiR7cXVlcnl9XCJgXG4gICAqICk7XG4gICAqXG4gICAqIEBwYXJhbSB7S2V5W119IGtleXNcbiAgICogQHBhcmFtIHsoc2xpY2U6IFBpY2tTbGljZTxUeXBlLCBLZXk+KSA9PiBWYWx1ZX0gZm5cbiAgICogQHBhcmFtIHtLZXlDb21wYXJlTWFwPFBpY2s8VHlwZSwgS2V5Pj59IGtleUNvbXBhcmVNYXBcbiAgICpcbiAgICogQHJldHVybiBPYnNlcnZhYmxlPFZhbHVlPlxuICAgKi9cbiAgc2VsZWN0PEtleSBleHRlbmRzIGtleW9mIFN0YXRlLCBWYWx1ZT4oXG4gICAga2V5czogS2V5W10sXG4gICAgZm4/OiAoc2xpY2U6IFBpY2tTbGljZTxTdGF0ZSwgS2V5PikgPT4gVmFsdWUsXG4gICAga2V5Q29tcGFyZU1hcD86IEtleUNvbXBhcmVNYXA8UGljazxTdGF0ZSwgS2V5Pj4sXG4gICk6IE9ic2VydmFibGU8VmFsdWU+O1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVHJhbnNmb3JtIGEgc2luZ2xlIHByb3BlcnR5IG9mIHRoZSBzdGF0ZSBieSBwcm92aWRpbmcgYSBrZXkgYW5kIG1hcCBmdW5jdGlvbi5cbiAgICogUmV0dXJucyByZXN1bHQgb2YgYXBwbHlpbmcgZnVuY3Rpb24gdG8gc3RhdGUgcHJvcGVydHkgYXMgY2FjaGVkIGFuZCBkaXN0aW5jdCBgT2JzZXJ2YWJsZTxWYWx1ZT5gLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBQcm9qZWN0IHN0YXRlIGJhc2VkIG9uIHNpbmdsZSBwcm9wZXJ0eVxuICAgKiBjb25zdCBmb28kID0gc3RhdGUuc2VsZWN0KCdiYXInLCBiYXIgPT4gYGJhciBlcXVhbHMgJHtiYXJ9YCk7XG4gICAqXG4gICAqIEBwYXJhbSB7S2V5fSBrZXlcbiAgICogQHBhcmFtIHsodmFsOiBUeXBlW0tleV0pID0+IFZhbHVlfSBmblxuICAgKlxuICAgKiBAcmV0dXJuIE9ic2VydmFibGU8VmFsdWU+XG4gICAqL1xuICBzZWxlY3Q8S2V5IGV4dGVuZHMga2V5b2YgU3RhdGUsIFZhbHVlPihcbiAgICBrZXk6IEtleSxcbiAgICBmbjogKHZhbDogU3RhdGVbS2V5XSkgPT4gVmFsdWUsXG4gICk6IE9ic2VydmFibGU8VmFsdWU+O1xuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogQWNjZXNzIGEgc2luZ2xlIHByb3BlcnR5IG9mIHRoZSBzdGF0ZSBieSBwcm92aWRpbmcga2V5cy5cbiAgICogUmV0dXJucyBhIHNpbmdsZSBwcm9wZXJ0eSBvZiB0aGUgc3RhdGUgYXMgY2FjaGVkIGFuZCBkaXN0aW5jdCBgT2JzZXJ2YWJsZTxTdGF0ZVtLZXlBXT5gLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBBY2Nlc3MgYSBzaW5nbGUgcHJvcGVydHlcbiAgICpcbiAgICogY29uc3QgYmFyJCA9IHN0YXRlLnNlbGVjdCgnYmFyJyk7XG4gICAqXG4gICAqIC8vIEFjY2VzcyBhIG5lc3RlZCBwcm9wZXJ0eVxuICAgKlxuICAgKiBjb25zdCBmb28kID0gc3RhdGUuc2VsZWN0KCdiYXInLCAnZm9vJyk7XG4gICAqXG4gICAqIEByZXR1cm4gT2JzZXJ2YWJsZTxUeXBlW0tleUFdPlxuICAgKi9cbiAgc2VsZWN0PEtleUEgZXh0ZW5kcyBrZXlvZiBTdGF0ZT4oa2V5QTogS2V5QSk6IE9ic2VydmFibGU8U3RhdGVbS2V5QV0+O1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNlbGVjdDxLZXlBIGV4dGVuZHMga2V5b2YgU3RhdGUsIEtleUIgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXT4oXG4gICAga2V5QTogS2V5QSxcbiAgICBrZXlCOiBLZXlCLFxuICApOiBPYnNlcnZhYmxlPFN0YXRlW0tleUFdW0tleUJdPjtcblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZWxlY3Q8XG4gICAgS2V5QSBleHRlbmRzIGtleW9mIFN0YXRlLFxuICAgIEtleUIgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXSxcbiAgICBLZXlDIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql0sXG4gID4oa2V5QTogS2V5QSwga2V5QjogS2V5Qiwga2V5QzogS2V5Qyk6IE9ic2VydmFibGU8U3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q10+O1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNlbGVjdDxcbiAgICBLZXlBIGV4dGVuZHMga2V5b2YgU3RhdGUsXG4gICAgS2V5QiBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdLFxuICAgIEtleUMgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXVtLZXlCXSxcbiAgICBLZXlEIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q10sXG4gID4oXG4gICAga2V5QTogS2V5QSxcbiAgICBrZXlCOiBLZXlCLFxuICAgIGtleUM6IEtleUMsXG4gICAga2V5RDogS2V5RCxcbiAgKTogT2JzZXJ2YWJsZTxTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXVtLZXlEXT47XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2VsZWN0PFxuICAgIEtleUEgZXh0ZW5kcyBrZXlvZiBTdGF0ZSxcbiAgICBLZXlCIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV0sXG4gICAgS2V5QyBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdLFxuICAgIEtleUQgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXSxcbiAgICBLZXlFIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q11bS2V5RF0sXG4gID4oXG4gICAga2V5QTogS2V5QSxcbiAgICBrZXlCOiBLZXlCLFxuICAgIGtleUM6IEtleUMsXG4gICAga2V5RDogS2V5RCxcbiAgICBrZXlFOiBLZXlFLFxuICApOiBPYnNlcnZhYmxlPFN0YXRlW0tleUFdW0tleUJdW0tleUNdW0tleURdW0tleUVdPjtcblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzZWxlY3Q8XG4gICAgS2V5QSBleHRlbmRzIGtleW9mIFN0YXRlLFxuICAgIEtleUIgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXSxcbiAgICBLZXlDIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql0sXG4gICAgS2V5RCBleHRlbmRzIGtleW9mIFN0YXRlW0tleUFdW0tleUJdW0tleUNdLFxuICAgIEtleUUgZXh0ZW5kcyBrZXlvZiBTdGF0ZVtLZXlBXVtLZXlCXVtLZXlDXVtLZXlEXSxcbiAgICBLZXlGIGV4dGVuZHMga2V5b2YgU3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q11bS2V5RF1bS2V5RV0sXG4gID4oXG4gICAga2V5QTogS2V5QSxcbiAgICBrZXlCOiBLZXlCLFxuICAgIGtleUM6IEtleUMsXG4gICAga2V5RDogS2V5RCxcbiAgICBrZXlFOiBLZXlFLFxuICAgIGtleUY6IEtleUYsXG4gICk6IE9ic2VydmFibGU8U3RhdGVbS2V5QV1bS2V5Ql1bS2V5Q11bS2V5RF1bS2V5RV1bS2V5Rl0+O1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHNlbGVjdDxSZXR1cm4+KFxuICAgIC4uLmFyZ3M6XG4gICAgICB8IE9wZXJhdG9yRnVuY3Rpb248U3RhdGUsIHVua25vd24+W11cbiAgICAgIHwgc3RyaW5nW11cbiAgICAgIHwgW2s6IHN0cmluZywgZm46ICh2YWw6IHVua25vd24pID0+IHVua25vd25dXG4gICAgICB8IFtcbiAgICAgICAgICBrZXlzOiBzdHJpbmdbXSxcbiAgICAgICAgICBmbj86IChzbGljZTogdW5rbm93bikgPT4gdW5rbm93bixcbiAgICAgICAgICBrZXlDb21wYXJlTWFwPzogS2V5Q29tcGFyZU1hcDxTdGF0ZT4sXG4gICAgICAgIF1cbiAgKTogT2JzZXJ2YWJsZTxTdGF0ZSB8IFJldHVybj4ge1xuICAgIHJldHVybiB0aGlzLmFjY3VtdWxhdG9yLnN0YXRlJC5waXBlKFxuICAgICAgc2VsZWN0KC4uLihhcmdzIGFzIFBhcmFtZXRlcnM8dHlwZW9mIHNlbGVjdD4pKSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBSZXR1cm5zIGEgc2lnbmFsIG9mIHRoZSBnaXZlbiBrZXkuIEl0J3MgZmlyc3QgdmFsdWUgaXMgZGV0ZXJtaW5lZCBieSB0aGVcbiAgICogY3VycmVudCBrZXlzIHZhbHVlIGluIFJ4U3RhdGUuIFdoZW5ldmVyIHRoZSBrZXkgZ2V0cyB1cGRhdGVkLCB0aGUgc2lnbmFsXG4gICAqIHdpbGwgYWxzbyBiZSB1cGRhdGVkIGFjY29yZGluZ2x5LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBmb29TaWduYWwgPSBzdGF0ZS5zaWduYWwoJ2ZvbycpO1xuICAgKlxuICAgKiBAcGFyYW0ge0tleX0ga2V5XG4gICAqXG4gICAqIEByZXR1cm4gU2lnbmFsPFN0YXRlW0tleV0+XG4gICAqL1xuICBzaWduYWw8S2V5IGV4dGVuZHMga2V5b2YgU3RhdGU+KGtleTogS2V5KTogU2lnbmFsPFN0YXRlW0tleV0+IHtcbiAgICByZXR1cm4gdGhpcy5zaWduYWxTdG9yZVByb3h5W2tleV07XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIExldHMgeW91IGNyZWF0ZSBhIGNvbXB1dGVkIHNpZ25hbCBiYXNlZCBvZmYgbXVsdGlwbGUga2V5cyBzdG9yZWQgaW4gUnhTdGF0ZS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogY29uc3QgY29tcHV0ZWRTaWduYWwgPSBzdGF0ZS5jb21wdXRlZCgocykgPT4gcy5mb28gKyBzLmJhcik7XG4gICAqXG4gICAqIEBwYXJhbSB7KHNsaWNlOiBTaWduYWxTdGF0ZVByb3h5PFR5cGU+KSA9PiBDb21wdXRlZFR5cGV9IGZuXG4gICAqIEByZXR1cm4gU2lnbmFsPENvbXB1dGVkVHlwZT5cbiAgICovXG4gIGNvbXB1dGVkPENvbXB1dGVkVHlwZT4oXG4gICAgZm46IChzbGljZTogU2lnbmFsU3RhdGVQcm94eTxTdGF0ZT4pID0+IENvbXB1dGVkVHlwZSxcbiAgKTogU2lnbmFsPENvbXB1dGVkVHlwZT4ge1xuICAgIHJldHVybiBjb21wdXRlZCgoKSA9PiB7XG4gICAgICByZXR1cm4gZm4odGhpcy5zaWduYWxTdG9yZVByb3h5KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogTGV0cyB5b3UgY3JlYXRlIGEgY29tcHV0ZWQgc2lnbmFsIGRlcml2ZWQgZnJvbSBzdGF0ZSBhbmQgcnhqcyBvcGVyYXRvcnMuXG4gICAqXG4gICAqIEB0aHJvd3MgSWYgdGhlIGluaXRpYWwgdmFsdWUgaXMgbm90IHByb3ZpZGVkIGFuZCB0aGUgc2lnbmFsIGlzIG5vdCBzeW5jLlxuICAgKiBVc2Ugc3RhcnRXaXRoKCkgdG8gcHJvdmlkZSBhbiBpbml0aWFsIHZhbHVlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBjb21wdXRlZFNpZ25hbCA9IHN0YXRlLmNvbXB1dGVkRnJvbShcbiAgICogICAgbWFwKHN0YXRlID0+IHN0YXRlLmZvbyksXG4gICAqICAgIGZpbHRlcihmb28gPT4gZm9vID4gNSlcbiAgICogICk7XG4gICAqXG4gICAqIEBwYXJhbSBvcDEgeyBPcGVyYXRvckZ1bmN0aW9uPFR5cGUsIFR5cGVBPiB9XG4gICAqIEByZXR1cm5zIFNpZ25hbDxUeXBlQT5cbiAgICovXG4gIGNvbXB1dGVkRnJvbTxUeXBlQSA9IFN0YXRlPihcbiAgICBvcDE6IE9wZXJhdG9yRnVuY3Rpb248U3RhdGUsIFR5cGVBPixcbiAgKTogU2lnbmFsPFR5cGVBPjtcblxuICAvKiogQGludGVybmFsICovXG4gIGNvbXB1dGVkRnJvbTxUeXBlQSA9IFN0YXRlLCBUeXBlQiA9IFR5cGVBPihcbiAgICBvcDE6IE9wZXJhdG9yRnVuY3Rpb248U3RhdGUsIFR5cGVBPixcbiAgICBvcDI6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUEsIFR5cGVCPixcbiAgKTogU2lnbmFsPFR5cGVCPjtcblxuICAvKiogQGludGVybmFsICovXG4gIGNvbXB1dGVkRnJvbTxUeXBlQSA9IFN0YXRlLCBUeXBlQiA9IFR5cGVBLCBUeXBlQyA9IFR5cGVCPihcbiAgICBvcDE6IE9wZXJhdG9yRnVuY3Rpb248U3RhdGUsIFR5cGVBPixcbiAgICBvcDI6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUEsIFR5cGVCPixcbiAgICBvcDM6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUIsIFR5cGVDPixcbiAgKTogU2lnbmFsPFR5cGVDPjtcblxuICAvKiogQGludGVybmFsICovXG4gIGNvbXB1dGVkRnJvbTxUeXBlQSA9IFN0YXRlLCBUeXBlQiA9IFR5cGVBLCBUeXBlQyA9IFR5cGVCLCBUeXBlRCA9IFR5cGVDPihcbiAgICBvcDE6IE9wZXJhdG9yRnVuY3Rpb248U3RhdGUsIFR5cGVBPixcbiAgICBvcDI6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUEsIFR5cGVCPixcbiAgICBvcDM6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUIsIFR5cGVDPixcbiAgICBvcDQ6IE9wZXJhdG9yRnVuY3Rpb248VHlwZUMsIFR5cGVEPixcbiAgKTogU2lnbmFsPFR5cGVEPjtcblxuICAvKiogQGludGVybmFsICovXG4gIGNvbXB1dGVkRnJvbTxcbiAgICBUeXBlQSA9IFN0YXRlLFxuICAgIFR5cGVCID0gVHlwZUEsXG4gICAgVHlwZUMgPSBUeXBlQixcbiAgICBUeXBlRCA9IFR5cGVDLFxuICAgIFR5cGVFID0gVHlwZUQsXG4gID4oXG4gICAgb3AxOiBPcGVyYXRvckZ1bmN0aW9uPFN0YXRlLCBUeXBlQT4sXG4gICAgb3AyOiBPcGVyYXRvckZ1bmN0aW9uPFR5cGVBLCBUeXBlQj4sXG4gICAgb3AzOiBPcGVyYXRvckZ1bmN0aW9uPFR5cGVCLCBUeXBlQz4sXG4gICAgb3A0OiBPcGVyYXRvckZ1bmN0aW9uPFR5cGVDLCBUeXBlRD4sXG4gICAgb3A1OiBPcGVyYXRvckZ1bmN0aW9uPFR5cGVELCBUeXBlRT4sXG4gICk6IFNpZ25hbDxUeXBlRT47XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBjb21wdXRlZEZyb208VHlwZT4oLi4ub3BzOiBPcGVyYXRvckZ1bmN0aW9uPFN0YXRlLCB1bmtub3duPltdKTogU2lnbmFsPFR5cGU+IHtcbiAgICByZXR1cm4gdG9TaWduYWw8VHlwZT4odGhpcy5zZWxlY3QoLi4uKG9wcyBhcyBQYXJhbWV0ZXJzPHR5cGVvZiBzZWxlY3Q+KSksIHtcbiAgICAgIGluamVjdG9yOiB0aGlzLmluamVjdG9yLFxuICAgICAgcmVxdWlyZVN5bmM6IHRydWUsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIE1hbmFnZXMgc2lkZS1lZmZlY3RzIG9mIHlvdXIgc3RhdGUuIFByb3ZpZGUgYW4gYE9ic2VydmFibGU8YW55PmBcbiAgICogKipzaWRlLWVmZmVjdCoqIGFuZCBhbiBvcHRpb25hbCBgc2lkZUVmZmVjdEZ1bmN0aW9uYC5cbiAgICogU3Vic2NyaXB0aW9uIGhhbmRsaW5nIGlzIGRvbmUgYXV0b21hdGljYWxseS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogLy8gRGlyZWN0bHkgcGFzcyBhbiBvYnNlcnZhYmxlIHNpZGUtZWZmZWN0XG4gICAqIGNvbnN0IGxvY2FsU3RvcmFnZUVmZmVjdCQgPSBjaGFuZ2VzJC5waXBlKFxuICAgKiAgdGFwKGNoYW5nZXMgPT4gc3RvcmVDaGFuZ2VzKGNoYW5nZXMpKVxuICAgKiApO1xuICAgKiBzdGF0ZS5ob2xkKGxvY2FsU3RvcmFnZUVmZmVjdCQpO1xuICAgKlxuICAgKiAvLyBQYXNzIGFuIGFkZGl0aW9uYWwgYHNpZGVFZmZlY3RGdW5jdGlvbmBcbiAgICpcbiAgICogY29uc3QgbG9jYWxTdG9yYWdlRWZmZWN0Rm4gPSBjaGFuZ2VzID0+IHN0b3JlQ2hhbmdlcyhjaGFuZ2VzKTtcbiAgICogc3RhdGUuaG9sZChjaGFuZ2VzJCwgbG9jYWxTdG9yYWdlRWZmZWN0Rm4pO1xuICAgKlxuICAgKiBAcGFyYW0ge09ic2VydmFibGU8U2lkZUVmZmVjdD59IG9ic09yT2JzV2l0aFNpZGVFZmZlY3RcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gW3NpZGVFZmZlY3RGbl1cbiAgICpcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICBob2xkPFNpZGVFZmZlY3Q+KFxuICAgIG9ic09yT2JzV2l0aFNpZGVFZmZlY3Q6IE9ic2VydmFibGU8U2lkZUVmZmVjdD4sXG4gICAgc2lkZUVmZmVjdEZuPzogKGFyZzogU2lkZUVmZmVjdCkgPT4gdm9pZCxcbiAgKTogdm9pZCB7XG4gICAgY29uc3Qgc2lkZUVmZmVjdCA9IG9ic09yT2JzV2l0aFNpZGVFZmZlY3QucGlwZShjYXRjaEVycm9yKChlKSA9PiBFTVBUWSkpO1xuICAgIGlmICh0eXBlb2Ygc2lkZUVmZmVjdEZuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLmVmZmVjdE9ic2VydmFibGUubmV4dEVmZmVjdE9ic2VydmFibGUoXG4gICAgICAgIHNpZGVFZmZlY3QucGlwZSh0YXAoc2lkZUVmZmVjdEZuKSksXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmVmZmVjdE9ic2VydmFibGUubmV4dEVmZmVjdE9ic2VydmFibGUoc2lkZUVmZmVjdCk7XG4gIH1cblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBzdWJzY3JpYmUoKTogVW5zdWJzY3JpYmFibGUge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgICBzdWJzY3JpcHRpb24uYWRkKHRoaXMuYWNjdW11bGF0b3Iuc3Vic2NyaWJlKCkpO1xuICAgIHN1YnNjcmlwdGlvbi5hZGQodGhpcy5lZmZlY3RPYnNlcnZhYmxlLnN1YnNjcmliZSgpKTtcbiAgICB0aGlzLnNpZ25hbFN0b3JlUHJveHkgPSBjcmVhdGVTaWduYWxTdGF0ZVByb3h5PFN0YXRlPihcbiAgICAgIHRoaXMuJCxcbiAgICAgIHRoaXMuZ2V0LmJpbmQodGhpcyksXG4gICAgKTtcbiAgICByZXR1cm4gc3Vic2NyaXB0aW9uO1xuICB9XG59XG4iXX0=